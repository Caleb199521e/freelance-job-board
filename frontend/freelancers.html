<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse Freelancers - LinkUP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/custom.css">
</head>
<body class="font-sans bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <a href="index.html" class="flex items-center space-x-2">
                        <img src="images/logo.png" alt="LinkUP Logo" class="h-12 w-auto">
                    </a>
                </div>
                
                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-4" id="navAuth">
                    <!-- Will be populated by auth.js -->
                </div>

                <!-- Mobile menu button -->
                <div class="md:hidden flex items-center">
                    <button id="mobileMenuBtn" type="button" class="text-gray-700 hover:text-emerald-600 focus:outline-none focus:text-emerald-600">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path id="menuIcon" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                            <path id="closeIcon" class="hidden" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile menu -->
        <div id="mobileMenu" class="hidden md:hidden border-t border-gray-200">
            <div id="mobileNavAuth" class="px-4 pt-2 pb-4 space-y-2">
                <!-- Will be populated by auth.js -->
            </div>
        </div>
    </nav>

    <!-- Header Section -->
    <div class="bg-gradient-to-r from-emerald-600 to-teal-600 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h1 class="text-4xl font-bold mb-4">Browse Freelancers</h1>
            <p class="text-xl text-emerald-100">Find talented professionals for your next project</p>
        </div>
    </div>

    <!-- Filters Section -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label for="searchInput" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-search text-emerald-600 mr-2"></i>Search
                    </label>
                    <input type="text" id="searchInput" 
                           placeholder="Search by name or skills..."
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent">
                </div>
                <div>
                    <label for="skillFilter" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-code text-emerald-600 mr-2"></i>Filter by Skill
                    </label>
                    <select id="skillFilter" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent">
                        <option value="">All Skills</option>
                    </select>
                </div>
                <div class="flex items-end">
                    <button id="clearFilters" 
                            class="w-full px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">
                        <i class="fas fa-times mr-2"></i>Clear Filters
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Freelancers Grid -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Loading State -->
        <div id="loadingState" class="text-center py-12">
            <i class="fas fa-spinner fa-spin text-4xl text-emerald-600"></i>
            <p class="text-gray-600 mt-4">Loading freelancers...</p>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="hidden text-center py-12">
            <i class="fas fa-user-slash text-6xl text-gray-400 mb-4"></i>
            <h3 class="text-xl font-semibold text-gray-700 mb-2">No Freelancers Found</h3>
            <p class="text-gray-600">Try adjusting your search criteria</p>
        </div>

        <!-- Freelancers Grid -->
        <div id="freelancersGrid" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Freelancer cards will be inserted here -->
        </div>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="js/toast.js"></script>
    <script src="js/config.js"></script>
    <script src="js/main.js"></script>
    <script src="js/mobile-menu.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/websocket.js"></script>
    <script>
        let allFreelancers = [];
        let filteredFreelancers = [];

        document.addEventListener('DOMContentLoaded', async () => {
            await loadFreelancers();
            setupFilters();
        });

        async function loadFreelancers() {
            try {
                const response = await fetch(`${API_BASE}/auth/freelancers`);
                
                if (!response.ok) {
                    throw new Error('Failed to load freelancers');
                }

                allFreelancers = await response.json();
                filteredFreelancers = [...allFreelancers];
                
                // Extract unique skills for filter
                const allSkills = new Set();
                allFreelancers.forEach(freelancer => {
                    if (freelancer.profile?.skills) {
                        freelancer.profile.skills.forEach(skill => allSkills.add(skill));
                    }
                });
                
                // Populate skill filter
                const skillFilter = document.getElementById('skillFilter');
                Array.from(allSkills).sort().forEach(skill => {
                    const option = document.createElement('option');
                    option.value = skill;
                    option.textContent = skill;
                    skillFilter.appendChild(option);
                });

                displayFreelancers(filteredFreelancers);
            } catch (error) {
                console.error('Error loading freelancers:', error);
                showToast('Failed to load freelancers', 'error');
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('emptyState').classList.remove('hidden');
            }
        }

        function displayFreelancers(freelancers) {
            const loadingState = document.getElementById('loadingState');
            const emptyState = document.getElementById('emptyState');
            const grid = document.getElementById('freelancersGrid');

            loadingState.classList.add('hidden');

            if (freelancers.length === 0) {
                emptyState.classList.remove('hidden');
                grid.classList.add('hidden');
                return;
            }

            emptyState.classList.add('hidden');
            grid.classList.remove('hidden');
            grid.innerHTML = '';

            freelancers.forEach(freelancer => {
                const card = createFreelancerCard(freelancer);
                grid.appendChild(card);
            });
        }

        function createFreelancerCard(freelancer) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-lg shadow-sm hover:shadow-lg transition duration-200 p-6';

            const name = freelancer.name || 'Anonymous User';
            const title = freelancer.profile?.title || 'Freelancer';
            const bio = freelancer.profile?.bio || 'No bio available';
            const skills = freelancer.profile?.skills || [];
            const hourlyRate = freelancer.profile?.hourlyRate || 'N/A';
            const contact = freelancer.profile?.contact || {};

            card.innerHTML = `
                <div class="flex items-start space-x-4 mb-4">
                    <div class="bg-emerald-100 rounded-full w-16 h-16 flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-user text-2xl text-emerald-600"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <h3 class="text-lg font-semibold text-gray-900 truncate">${name}</h3>
                        <p class="text-sm text-gray-600">${title}</p>
                        <p class="text-sm text-emerald-600 font-semibold mt-1">
                            ${hourlyRate !== 'N/A' ? `GHâ‚µ${hourlyRate}/hr` : 'Rate not set'}
                        </p>
                    </div>
                </div>

                <p class="text-gray-700 text-sm mb-4 line-clamp-3">${bio}</p>

                ${skills.length > 0 ? `
                    <div class="mb-4">
                        <p class="text-xs font-semibold text-gray-600 mb-2">SKILLS</p>
                        <div class="flex flex-wrap gap-2">
                            ${skills.slice(0, 5).map(skill => `
                                <span class="px-2 py-1 bg-emerald-50 text-emerald-700 text-xs rounded-full">
                                    ${skill}
                                </span>
                            `).join('')}
                            ${skills.length > 5 ? `
                                <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full">
                                    +${skills.length - 5} more
                                </span>
                            ` : ''}
                        </div>
                    </div>
                ` : ''}

                <div class="border-t border-gray-200 pt-4 space-y-2">
                    <p class="text-xs font-semibold text-gray-600 mb-2">CONTACT</p>
                    
                    ${contact.phone ? `
                        <a href="tel:${contact.phone}" 
                           class="flex items-center text-sm text-gray-700 hover:text-emerald-600 transition">
                            <i class="fas fa-phone w-5 text-emerald-600"></i>
                            <span class="ml-2">${contact.phone}</span>
                        </a>
                    ` : ''}

                    ${contact.website ? `
                        <a href="${contact.website}" 
                           target="_blank"
                           class="flex items-center text-sm text-gray-700 hover:text-emerald-600 transition">
                            <i class="fas fa-globe w-5 text-emerald-600"></i>
                            <span class="ml-2 truncate">Website/WhatsApp</span>
                        </a>
                    ` : ''}

                    ${contact.linkedin ? `
                        <a href="${contact.linkedin}" 
                           target="_blank"
                           class="flex items-center text-sm text-gray-700 hover:text-emerald-600 transition">
                            <i class="fab fa-linkedin w-5 text-emerald-600"></i>
                            <span class="ml-2">LinkedIn</span>
                        </a>
                    ` : ''}

                    ${contact.github ? `
                        <a href="${contact.github}" 
                           target="_blank"
                           class="flex items-center text-sm text-gray-700 hover:text-emerald-600 transition">
                            <i class="fab fa-github w-5 text-emerald-600"></i>
                            <span class="ml-2">GitHub</span>
                        </a>
                    ` : ''}
                </div>

                <div class="mt-4 pt-4 border-t border-gray-200">
                    <a href="freelancer-profile.html?id=${freelancer._id}" 
                       class="block w-full text-center px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition">
                        View Full Profile
                    </a>
                </div>
            `;

            return card;
        }

        function setupFilters() {
            const searchInput = document.getElementById('searchInput');
            const skillFilter = document.getElementById('skillFilter');
            const clearFilters = document.getElementById('clearFilters');

            searchInput.addEventListener('input', applyFilters);
            skillFilter.addEventListener('change', applyFilters);
            clearFilters.addEventListener('click', () => {
                searchInput.value = '';
                skillFilter.value = '';
                applyFilters();
            });
        }

        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const selectedSkill = document.getElementById('skillFilter').value;

            filteredFreelancers = allFreelancers.filter(freelancer => {
                // Search filter
                const matchesSearch = !searchTerm || 
                    (freelancer.name && freelancer.name.toLowerCase().includes(searchTerm)) ||
                    (freelancer.profile?.title && freelancer.profile.title.toLowerCase().includes(searchTerm)) ||
                    (freelancer.profile?.skills && freelancer.profile.skills.some(skill => 
                        skill.toLowerCase().includes(searchTerm)
                    ));

                // Skill filter
                const matchesSkill = !selectedSkill || 
                    (freelancer.profile?.skills && freelancer.profile.skills.includes(selectedSkill));

                return matchesSearch && matchesSkill;
            });

            displayFreelancers(filteredFreelancers);
        }
    </script>
</body>
</html>
